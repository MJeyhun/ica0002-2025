Thu Jan 15 08:35:20 EET 2026
JM

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host MJeyhun-1 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host MJeyhun-2 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host MJeyhun-3 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [init : Update APT cache] *************************************************
changed: [MJeyhun-3]
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [init : Install Prometheus Node Exporter] *********************************
The following additional packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
Suggested packages:
  freeipmi-tools snmp-mibs-downloader gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi prometheus-node-exporter
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
0 upgraded, 18 newly installed, 0 to remove and 259 not upgraded.
changed: [MJeyhun-3]
The following additional packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
Suggested packages:
  freeipmi-tools snmp-mibs-downloader gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi prometheus-node-exporter
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
0 upgraded, 18 newly installed, 0 to remove and 259 not upgraded.
changed: [MJeyhun-1]
The following additional packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
Suggested packages:
  freeipmi-tools snmp-mibs-downloader gsmartcontrol smart-notifier mailx
  | mailutils
The following NEW packages will be installed:
  freeipmi-common ipmitool libfreeipmi17 libio-pty-perl libipc-run-perl
  libopenipmi0t64 libsnmp-base libsnmp40t64 libtime-duration-perl
  libtimedate-perl moreutils nvme-cli openipmi prometheus-node-exporter
  prometheus-node-exporter-collectors python3-decorator
  python3-prometheus-client smartmontools
0 upgraded, 18 newly installed, 0 to remove and 259 not upgraded.
changed: [MJeyhun-2]

TASK [init : Ensure Prometheus Node Exporter is started and enabled] ***********
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [init : Add Grafana GPG key] **********************************************
changed: [MJeyhun-1]
changed: [MJeyhun-3]
changed: [MJeyhun-2]

TASK [init : Add grafana repo] *************************************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/grafana.list
@@ -0,0 +1 @@
+deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main

changed: [MJeyhun-2]
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/grafana.list
@@ -0,0 +1 @@
+deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main

changed: [MJeyhun-1]
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/grafana.list
@@ -0,0 +1 @@
+deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main

changed: [MJeyhun-3]

TASK [init : Ensure the "backup" user exists and SSH key pair is generated] ****
changed: [MJeyhun-1]
changed: [MJeyhun-3]
changed: [MJeyhun-2]

TASK [init : Add backup server SSH key to known_hosts for user backup] *********
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmps_9p_e5c/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup.batice.ttu ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX

changed: [MJeyhun-1]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp1c03drye/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup.batice.ttu ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX

changed: [MJeyhun-2]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp_g956fka/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX
+backup.batice.ttu ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAtnpnME3TsMyvcJyiYawMBod33jkDcFG9Pb1rlxDiXX

changed: [MJeyhun-3]

TASK [init : Ensure restore directory exists] **********************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0750",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-1]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0750",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-2]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0750",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3]

TASK [init : Install duplicity] ************************************************
The following additional packages will be installed:
  librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
Suggested packages:
  ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2 python-nacl-doc
  python3-gssapi python3-invoke
The following NEW packages will be installed:
  duplicity librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
0 upgraded, 6 newly installed, 0 to remove and 259 not upgraded.
changed: [MJeyhun-2]
The following additional packages will be installed:
  librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
Suggested packages:
  ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2 python-nacl-doc
  python3-gssapi python3-invoke
The following NEW packages will be installed:
  duplicity librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
0 upgraded, 6 newly installed, 0 to remove and 259 not upgraded.
changed: [MJeyhun-3]
The following additional packages will be installed:
  librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
Suggested packages:
  ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2 python-nacl-doc
  python3-gssapi python3-invoke
The following NEW packages will be installed:
  duplicity librsync2t64 python3-fasteners python3-monotonic python3-nacl
  python3-paramiko
0 upgraded, 6 newly installed, 0 to remove and 259 not upgraded.
changed: [MJeyhun-1]

PLAY [DNS Servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [bind : Install bind9] ****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [bind : Install dnspython] ************************************************
Suggested packages:
  python3-trio python3-aioquic python3-h2 python3-httpx python3-httpcore
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]
Suggested packages:
  python3-trio python3-aioquic python3-h2 python3-httpx python3-httpcore
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]
Suggested packages:
  python3-trio python3-aioquic python3-h2 python3-httpx python3-httpcore
The following NEW packages will be installed:
  python3-dnspython
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]

TASK [bind : template] *********************************************************
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-2] => (item=None)
changed: [MJeyhun-1] => (item=None)
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3]
changed: [MJeyhun-1] => (item=None)
changed: [MJeyhun-1]
changed: [MJeyhun-2] => (item=None)
changed: [MJeyhun-2]

TASK [bind : template] *********************************************************
skipping: [MJeyhun-2]
skipping: [MJeyhun-1]
changed: [MJeyhun-3]

TASK [bind : template] *********************************************************
skipping: [MJeyhun-2]
skipping: [MJeyhun-1]
changed: [MJeyhun-3]

TASK [bind : Flush] ************************************************************

TASK [bind : Flush] ************************************************************

TASK [bind : Flush] ************************************************************

RUNNING HANDLER [bind : restart bind] ******************************************
changed: [MJeyhun-2]
changed: [MJeyhun-3]
changed: [MJeyhun-1]

RUNNING HANDLER [bind : reload rndc] *******************************************
changed: [MJeyhun-3]

TASK [bind : Enable bind9] *****************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [bind : Install Bind9 exporter] *******************************************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]

TASK [bind : Ensure Bind exporter is running and enabled] **********************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [bind : Add A records] ****************************************************
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3]

TASK [bind : Add CNAME records for nameserver] *********************************
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3]

RUNNING HANDLER [bind : reload rndc] *******************************************
changed: [MJeyhun-3]

PLAY [Resolve] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [resolver : Check if /etc/resolver.conf exists] ***************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [resolver : Unlink /etc/resolv.conf if it exists and is a symlink] ********
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/resolv.conf",
-    "state": "link"
+    "state": "absent"
 }

changed: [MJeyhun-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/resolv.conf",
-    "state": "link"
+    "state": "absent"
 }

changed: [MJeyhun-3]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/resolv.conf",
-    "state": "link"
+    "state": "absent"
 }

changed: [MJeyhun-2]

TASK [resolver : Apply /etc/resolv.conf template] ******************************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmplnewsfob/resolv.conf.j2
@@ -0,0 +1,3 @@
+search batice.ttu
+nameserver 192.168.42.163
+nameserver 192.168.42.150

changed: [MJeyhun-3]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpdkij1tx0/resolv.conf.j2
@@ -0,0 +1,3 @@
+search batice.ttu
+nameserver 192.168.42.163
+nameserver 192.168.42.150

changed: [MJeyhun-1]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpdvldtpfi/resolv.conf.j2
@@ -0,0 +1,3 @@
+search batice.ttu
+nameserver 192.168.42.163
+nameserver 192.168.42.150

changed: [MJeyhun-2]

PLAY [Web Servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [docker : Install Docker and prerequisites] *******************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx
  docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx
  docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [docker : Ensure Docker service is running] *******************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [docker : Install Loki Docker plugin] *************************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [agama : Create /opt/agama directory] *************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-1]

TASK [agama : Download Agama app and Dockerfile] *******************************
changed: [MJeyhun-2] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/agama.py', 'dest': 'agama.py'})
changed: [MJeyhun-1] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/agama.py', 'dest': 'agama.py'})
changed: [MJeyhun-2] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/Dockerfile', 'dest': 'Dockerfile'})
changed: [MJeyhun-1] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/Dockerfile', 'dest': 'Dockerfile'})

TASK [agama : Build Agama Docker image] ****************************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [agama : Start Agama Docker container] ************************************
changed: [MJeyhun-1] => (item=None)
changed: [MJeyhun-2] => (item=None)
changed: [MJeyhun-2] => (item=None)
changed: [MJeyhun-1] => (item=None)
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [agama : Add CNAME records for Web Servers] *******************************
changed: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
changed: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
changed: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

TASK [nginx : install nginx] ***************************************************
The following additional packages will be installed:
  nginx-common
Suggested packages:
  fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  nginx nginx-common
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]
The following additional packages will be installed:
  nginx-common
Suggested packages:
  fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  nginx nginx-common
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]

TASK [nginx : Apply Nginx configuration using template] ************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpj4cgi941/default.j2
@@ -1,91 +1,21 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+log_format agama_format '$status $request_time';
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
+    listen 80 default_server;
+    server_name _;
+                location / {
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+		proxy_pass http://localhost:8001;
+		access_log /var/log/nginx/access.log;
+		access_log /var/log/nginx/agama.log agama_format;
+        }
+	        	
+	
 }
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+server {
+	listen 8080 default_server;
+	location /stub_status {
+		stub_status;
+	}
+}

changed: [MJeyhun-1]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp661gmsz9/default.j2
@@ -1,91 +1,21 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+log_format agama_format '$status $request_time';
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
+    listen 80 default_server;
+    server_name _;
+                location / {
 
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+		proxy_pass http://localhost:8001;
+		access_log /var/log/nginx/access.log;
+		access_log /var/log/nginx/agama.log agama_format;
+        }
+	        	
+	
 }
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+server {
+	listen 8080 default_server;
+	location /stub_status {
+		stub_status;
+	}
+}

changed: [MJeyhun-2]

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Flush handlers] **************************************************

RUNNING HANDLER [agama : reload rndc] ******************************************
changed: [MJeyhun-1]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [nginx : Nginx service] ***************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [nginx : Install Nginx exporter] ******************************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [nginx : Ensure nginx exporter started] ***********************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Install MySQL server] ********************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libio-compress-brotli-perl
  libbusiness-isbn-perl libregexp-ipv6-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server mysql-server-8.0
  mysql-server-core-8.0
0 upgraded, 27 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libio-compress-brotli-perl
  libbusiness-isbn-perl libregexp-ipv6-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7t64 libfcgi-bin libfcgi-perl libfcgi0t64
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite32t64 liburi-perl
  mecab-ipadic mecab-ipadic-utf8 mecab-utils mysql-client-8.0
  mysql-client-core-8.0 mysql-common mysql-server mysql-server-8.0
  mysql-server-core-8.0
0 upgraded, 27 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [mysql : Ensure MySQL service is started and enabled] *********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : MySQL override.cnf] **********************************************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmplt4_df4j/override.cnf.j2
@@ -0,0 +1,7 @@
+[mysqld]
+bind-address = 0.0.0.0
+
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 150

changed: [MJeyhun-1]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmppgxvf0n0/override.cnf.j2
@@ -0,0 +1,7 @@
+[mysqld]
+bind-address = 0.0.0.0
+
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 163

changed: [MJeyhun-2]

TASK [mysql : Install Python MySQL library] ************************************
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]

TASK [mysql : MySQL database] **************************************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : MySQL User] ******************************************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : Install MySQL exporter] ******************************************
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [mysql : Cnf files for exporter] ******************************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : Create MySQL user for the exporter] ******************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : Configure mysqld_exporter systemd service to use .my.cnf] ********
--- before: /etc/default/prometheus-mysqld-exporter (content)
+++ after: /etc/default/prometheus-mysqld-exporter (content)
@@ -2,7 +2,7 @@
 # Due to shell escaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--config.my-cnf=/var/lib/prometheus/.my.cnf"
 
 ### Database authentication
 #

changed: [MJeyhun-2]
--- before: /etc/default/prometheus-mysqld-exporter (content)
+++ after: /etc/default/prometheus-mysqld-exporter (content)
@@ -2,7 +2,7 @@
 # Due to shell escaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--config.my-cnf=/var/lib/prometheus/.my.cnf"
 
 ### Database authentication
 #

changed: [MJeyhun-1]

TASK [mysql : Ensure Prometheus MySQL Exporter is started and enabled] *********
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : Ensure MySQL backup directory exists] ****************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0750",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-2]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0750",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-1]

TASK [mysql : Create backup MySQL user and grant privileges] *******************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [mysql : Create .my.cnf for backup user] **********************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : Ensure /etc/cron.d/mysql-backup is created] **********************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpv290ruj8/backup-cron.j2
@@ -0,0 +1 @@
+

changed: [MJeyhun-1]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp7l8xh29u/backup-cron.j2
@@ -0,0 +1,2 @@
+15 00 * * *  backup  mysqldump agama > /home/backup/mysql/agama.sql
+16 00 * * *  backup  duplicity --no-encryption full /home/backup/mysql/ rsync://MJeyhun@backup.batice.ttu/mysql

changed: [MJeyhun-2]

TASK [mysql : start cron] ******************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Create replication user with REPLICATION SLAVE permissions] ******
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [mysql : Set MySQL read_only mode dynamically] ****************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [mysql : Add CNAME records for mysql] *************************************
changed: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
changed: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
changed: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

RUNNING HANDLER [mysql : Restart MySQL] ****************************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

RUNNING HANDLER [mysql : Restart mysqld-exporter] ******************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

RUNNING HANDLER [mysql : restart cron] *****************************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

RUNNING HANDLER [mysql : Reset MySQL source] ***********************************
skipping: [MJeyhun-2] => (item=stopreplica) 
skipping: [MJeyhun-2] => (item=resetprimary) 
skipping: [MJeyhun-2]
changed: [MJeyhun-1] => (item=stopreplica)
changed: [MJeyhun-1] => (item=resetprimary)

RUNNING HANDLER [mysql : Reset MySQL replica] **********************************
skipping: [MJeyhun-1] => (item=stopreplica) 
skipping: [MJeyhun-1] => (item=changeprimary) 
skipping: [MJeyhun-1] => (item=resetreplica) 
skipping: [MJeyhun-1] => (item=startreplica) 
skipping: [MJeyhun-1]
changed: [MJeyhun-2] => (item=stopreplica)
changed: [MJeyhun-2] => (item=changeprimary)
changed: [MJeyhun-2] => (item=resetreplica)
changed: [MJeyhun-2] => (item=startreplica)

RUNNING HANDLER [mysql : reload rndc] ******************************************
changed: [MJeyhun-1]

PLAY [Prometheus Server] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [prometheus : install prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
Suggested packages:
  apache2 | lighttpd | httpd
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
  prometheus
0 upgraded, 16 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]

TASK [prometheus : Ensure Prometheus service is enabled and started] ***********
ok: [MJeyhun-3]

TASK [prometheus : Apply Prometheus default configuration from template] *******
changed: [MJeyhun-3]

TASK [prometheus : Update Prometheus config] ***********************************
changed: [MJeyhun-3]

TASK [prometheus : Install Prometheus backup cron] *****************************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpk1k1kfcu/backup-cron.j2
@@ -0,0 +1,3 @@
+10 22 * * * backup curl -XPOST http://localhost:9090/prometheus/api/v1/admin/tsdb/snapshot
+20 22 * * *  backup  duplicity --no-encryption full /var/lib/prometheus/metrics2/snapshots/ rsync://MJeyhun@backup.batice.ttu/prometheus
+22 22 * * *  backup  duplicity --no-encryption incremental /var/lib/prometheus/metrics2/snapshots/ rsync://MJeyhun@backup.batice.ttu/prometheus

changed: [MJeyhun-3]

TASK [prometheus : start cron] *************************************************
ok: [MJeyhun-3]

TASK [prometheus : Add CNAME records for prometheus] ***************************
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

TASK [nginx : install nginx] ***************************************************
The following additional packages will be installed:
  nginx-common
Suggested packages:
  fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  nginx nginx-common
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]

TASK [nginx : Apply Nginx configuration using template] ************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpa4msb03f/default.j2
@@ -1,91 +1,25 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+log_format agama_format '$status $request_time';
 
-# Default server configuration
-#
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+    listen 80 default_server;
+    server_name _;
+        	    	location / {
+		try_files $uri $uri/ =404; 
 	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+                        location /prometheus {
+            proxy_pass http://localhost:9090;
+        }
+        	
+	        location /grafana {
+		proxy_set_header Host $http_host;
+                proxy_pass http://localhost:3001;
+        }
+	
 }
 
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+server {
+	listen 8080 default_server;
+	location /stub_status {
+		stub_status;
+	}
+}

changed: [MJeyhun-3]

TASK [nginx : Flush handlers] **************************************************

RUNNING HANDLER [prometheus : Restart Prometheus] ******************************
changed: [MJeyhun-3]

RUNNING HANDLER [prometheus : restart cron] ************************************
changed: [MJeyhun-3]

RUNNING HANDLER [prometheus : reload rndc] *************************************
changed: [MJeyhun-3]

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [MJeyhun-3]

TASK [nginx : Nginx service] ***************************************************
ok: [MJeyhun-3]

TASK [nginx : Install Nginx exporter] ******************************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]

TASK [nginx : Ensure nginx exporter started] ***********************************
ok: [MJeyhun-3]

PLAY [Grafana server] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [docker : Install Docker and prerequisites] *******************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx
  docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]

TASK [docker : Ensure Docker service is running] *******************************
ok: [MJeyhun-3]

TASK [docker : Install Loki Docker plugin] *************************************
changed: [MJeyhun-3]

TASK [grafana : Create Grafana directories] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3] => (item=/opt/grafana)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3] => (item=/opt/grafana/provisioning)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3] => (item=/opt/grafana/provisioning/dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Create Grafana configuration file from template securely] ******
changed: [MJeyhun-3]

TASK [grafana : Grafana Docker container] **************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [MJeyhun-3]

TASK [grafana : Create Grafana dashboard file] *********************************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpz5v7xn16/dashboards.yaml.j2
@@ -0,0 +1,16 @@
+# # config file version
+apiVersion: 1
+
+providers:
+ - name: 'Main'
+   orgId: 1
+   folder: ''
+   folderUid: ''
+   type: file
+   allowUiUpdates: true
+   disableDeletion: false
+   updateIntervalSeconds: 10
+   options:
+     path: /etc/grafana/provisioning/dashboards
+
+

changed: [MJeyhun-3]

TASK [grafana : Create Grafana datasource provisioning file] *******************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpcgigkqmy/datasources.yaml.j2
@@ -0,0 +1,21 @@
+apiVersion: 1
+datasources:
+  - name: Prometheus
+    type: prometheus
+    access: proxy
+    orgId: 1
+    url: http://prometheus:9090/prometheus
+    uid: be9wall15qn0gf
+    isDefault: true
+    version: 1
+    editable: false
+
+  - name: Loki
+    type: loki
+    access: proxy
+    orgId: 1
+    url: http://loki:3100   # replace with your Loki VM IP if you don't have a group
+    uid: loki_datasource_1
+    isDefault: false
+    version: 1
+    editable: false

changed: [MJeyhun-3]

TASK [grafana : Upload main.json to the server] ********************************
--- before
+++ after: /home/raven/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1429 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 2,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 0,
+        "y": 0
+      },
+      "id": 3,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "be9wall15qn0gf"
+          },
+          "editorMode": "code",
+          "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m])",
+          "hide": false,
+          "instant": false,
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "B"
+        }
+      ],
+      "title": "A DNS Queries per Minute",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "description": "Requests per Minute",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 6,
+        "y": 0
+      },
+      "id": 5,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "rate(nginx_http_requests_total[1m])",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx Requests per Minute",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": 0
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 2,
+        "x": 12,
+        "y": 0
+      },
+      "id": 7,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "up{job=\"nginx\"}",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": 0
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 2,
+        "x": 14,
+        "y": 0
+      },
+      "id": 8,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "up{job=\"mysql\"}",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-red",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 2,
+        "x": 16,
+        "y": 0
+      },
+      "id": 13,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "haproxy_up\r\n",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Haproxy Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-red",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 2,
+        "x": 18,
+        "y": 0
+      },
+      "id": 15,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "keepalived_up",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "keepalived status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": 0
+              },
+              {
+                "color": "green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 2,
+        "x": 20,
+        "y": 0
+      },
+      "id": 6,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "bind_up",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9 Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "loki",
+        "uid": "loki_datasource_1"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-red",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 90
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 2,
+        "x": 22,
+        "y": 0
+      },
+      "id": 12,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "loki",
+            "uid": "loki_datasource_1"
+          },
+          "direction": "backward",
+          "editorMode": "code",
+          "expr": "100 * (\r\n  sum(rate({job=\"haproxy\", service=\"haproxy\"} |~ \"^[23]\\\\d\\\\d \" [7d]))\r\n  /\r\n  sum(rate({job=\"haproxy\", service=\"haproxy\"} |~ \"^\\\\d{3} \" [7d]))\r\n)",
+          "legendFormat": "{{host}}",
+          "queryType": "range",
+          "refId": "A"
+        }
+      ],
+      "title": "Availability",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 0,
+        "y": 5
+      },
+      "id": 4,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m])",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL  SELECT Commands per Minute",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 5,
+        "x": 6,
+        "y": 5
+      },
+      "id": 1,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "be9wall15qn0gf"
+          },
+          "editorMode": "code",
+          "expr": "100 - (rate(node_cpu_seconds_total{mode=\"idle\"}[1m])) * 100",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "CPU Utilization on VMs",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 11,
+        "y": 5
+      },
+      "id": 2,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Memory Consumption on VMs",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 7,
+        "x": 17,
+        "y": 5
+      },
+      "id": 10,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "sum(rate(promtail_sent_entries_total[1m]))\r\n",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": " Rate of Promtail Sent Entries",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 6,
+        "x": 0,
+        "y": 10
+      },
+      "id": 9,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "sum(rate(loki_log_messages_total[1m]))",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Rate of Loki Total Messages",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "loki",
+        "uid": "loki_datasource_1"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "line"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-green",
+                "value": 0
+              },
+              {
+                "color": "dark-red",
+                "value": 0.5
+              }
+            ]
+          },
+          "unit": "ms"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 9,
+        "x": 6,
+        "y": 10
+      },
+      "id": 11,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "timezone": [
+          ""
+        ],
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "loki",
+            "uid": "loki_datasource_1"
+          },
+          "direction": "backward",
+          "editorMode": "code",
+          "expr": "avg(\r\n  avg_over_time(\r\n    {job=\"haproxy\"}\r\n    |~ \"\\\\d{3} \\\\d+\"\r\n    | regexp \"(?P<status_code>[0-9]{3}) (?P<request_time>[0-9.]+)\"\r\n    | unwrap request_time\r\n    [7d]\r\n  )\r\n)",
+          "legendFormat": "{{host}}",
+          "queryType": "range",
+          "refId": "A"
+        }
+      ],
+      "title": "Latency of Agama",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "1": {
+                  "index": 0,
+                  "text": "Master"
+                },
+                "2": {
+                  "index": 1,
+                  "text": "Backup"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "dark-blue",
+                "value": 2
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 4,
+        "x": 15,
+        "y": 10
+      },
+      "id": 16,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "keepalived_vrrp_state\r\n",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "keepalived vrrp state",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": "Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": "Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-red",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 23,
+        "x": 0,
+        "y": 16
+      },
+      "id": 14,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "haproxy_server_up",
+          "legendFormat": "{{instance}}{{backend}}{{server}}{{status (0/1)}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Haproxy Server Status for each container",
+      "type": "stat"
+    }
+  ],
+  "preload": false,
+  "schemaVersion": 42,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-3h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "Main",
+  "uid": "ce9wbbjq8x9tsd",
+  "version": 1
+}

changed: [MJeyhun-3] => (item=main.json)
--- before
+++ after: /home/raven/ica0002/roles/grafana/files/backups.json
@@ -0,0 +1,177 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 0,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "blue",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "s"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 22,
+        "x": 0,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "exemplar": false,
+          "expr": "time() - backup_last_success_time{user=\"MJeyhun\"}",
+          "instant": false,
+          "interval": "",
+          "legendFormat": "{{service}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Last backup age",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 6,
+        "w": 22,
+        "x": 0,
+        "y": 7
+      },
+      "id": 1,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "be9wall15qn0gf"
+          },
+          "editorMode": "builder",
+          "expr": "backups_total{user=\"MJeyhun\"}\r\n",
+          "legendFormat": "{{service}} {{type}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Backup Counts",
+      "type": "stat"
+    }
+  ],
+  "preload": false,
+  "schemaVersion": 42,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-5m",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "Backups",
+  "uid": "mj5b2h2",
+  "version": 2
+}

changed: [MJeyhun-3] => (item=backups.json)
--- before
+++ after: /home/raven/ica0002/roles/grafana/files/agama_logs.json
@@ -0,0 +1,82 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 0,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "loki",
+        "uid": "loki_datasource_1"
+      },
+      "fieldConfig": {
+        "defaults": {},
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 23,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 1,
+      "options": {
+        "dedupStrategy": "none",
+        "enableInfiniteScrolling": false,
+        "enableLogDetails": true,
+        "showControls": false,
+        "showTime": false,
+        "sortOrder": "Descending",
+        "wrapLogMessage": false
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "loki",
+            "uid": "loki_datasource_1"
+          },
+          "direction": "backward",
+          "editorMode": "code",
+          "expr": "{job=\"agama\"}\r\n",
+          "queryType": "range",
+          "refId": "A"
+        }
+      ],
+      "title": "Agama logs",
+      "type": "logs"
+    }
+  ],
+  "preload": false,
+  "schemaVersion": 42,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-15m",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "Agama Logs",
+  "uid": "mj4w628",
+  "version": 5
+}

changed: [MJeyhun-3] => (item=agama_logs.json)
--- before
+++ after: /home/raven/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,558 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 4,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 0,
+                  "text": "Writable"
+                },
+                "1": {
+                  "index": 1,
+                  "text": "Read-only"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "dark-purple",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 21,
+        "w": 3,
+        "x": 0,
+        "y": 0
+      },
+      "id": 5,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_global_variables_read_only\r\n",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Read-only status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 9,
+        "w": 12,
+        "x": 3,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m])",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "A DNS Queries per Minute",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 21,
+        "w": 9,
+        "x": 15,
+        "y": 0
+      },
+      "id": 6,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_io_running",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        },
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "be9wall15qn0gf"
+          },
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_sql_running\r\n",
+          "hide": false,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "B"
+        }
+      ],
+      "title": "Replication threads",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "showValues": false,
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 12,
+        "x": 3,
+        "y": 9
+      },
+      "id": 1,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "hideZeros": false,
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "be9wall15qn0gf"
+          },
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m])",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL  SELECT Commands per Minute",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "be9wall15qn0gf"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 3,
+        "y": 16
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "mysql_global_variables_server_id\r\n",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Server ID",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "uid": "Prometheus"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 1,
+                  "text": " Down"
+                },
+                "1": {
+                  "index": 0,
+                  "text": " Up"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-red",
+                "value": 0
+              },
+              {
+                "color": "dark-green",
+                "value": 0.5
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 5,
+        "w": 6,
+        "x": 9,
+        "y": 16
+      },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "12.3.1",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "up{job=\"mysql\"}",
+          "legendFormat": "{{instance}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Status",
+      "type": "stat"
+    }
+  ],
+  "preload": false,
+  "schemaVersion": 42,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "MySQL",
+  "uid": "mjk6ggz",
+  "version": 2
+}

changed: [MJeyhun-3] => (item=mysql.json)

TASK [grafana : Add CNAME records for Grafana] *********************************
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

RUNNING HANDLER [grafana : Restart Grafana container] **************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "restarted": false,
+    "restarted": true,
     "running": true
 }

changed: [MJeyhun-3]

RUNNING HANDLER [grafana : reload rndc] ****************************************
changed: [MJeyhun-3]

PLAY [Loki server] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [loki : Install Loki] *****************************************************
The following NEW packages will be installed:
  loki
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]

TASK [loki : Create Loki data directory] ***************************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 111,
     "path": "/var/lib/loki",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3]

TASK [loki : Configure Loki] ***************************************************
--- before: /etc/loki/config.yml
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpfxihfxq9/config.yml.j2
@@ -7,7 +7,7 @@
   grpc_server_max_concurrent_streams: 1000
 
 common:
-  instance_addr: 127.0.0.1
+  instance_addr: localhost
   path_prefix: /tmp/loki
   storage:
     filesystem:
@@ -26,8 +26,8 @@
         max_size_mb: 100
 
 limits_config:
-  metric_aggregation_enabled: true
-  enable_multi_variant_queries: true
+  ingestion_rate_mb: 10 
+  ingestion_burst_size_mb: 20
 
 schema_config:
   configs:
@@ -50,16 +50,6 @@
 frontend:
   encoding: protobuf
 
-
-# By default, Loki will send anonymous, but uniquely-identifiable usage and configuration
-# analytics to Grafana Labs. These statistics are sent to https://stats.grafana.org/
-#
-# Statistics help us better understand how Loki is used, and they show us performance
-# levels for most users. This helps us prioritize features and documentation.
-# For more information on what's sent, look at
-# https://github.com/grafana/loki/blob/main/pkg/analytics/stats.go
-# Refer to the buildReport method to see what goes into a report.
-#
-# If you would like to disable reporting, uncomment the following lines:
-#analytics:
-#  reporting_enabled: false
+querier:
+  engine:
+    #enable_multi_variant_queries: true

changed: [MJeyhun-3]

TASK [loki : Enable and start Loki] ********************************************
ok: [MJeyhun-3]

TASK [loki : Ensure Loki backup directory exists] ******************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0750",
+    "owner": 34,
     "path": "/home/backup/loki",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3]

TASK [loki : Install Loki backup cron] *****************************************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmps3ut19xb/backup-cron.j2
@@ -0,0 +1,4 @@
+36 23 * * * backup cp -r /tmp/loki/tsdb-shipper-active /home/backup/loki/ && cp -r /tmp/loki/wal /home/backup/loki/ && chown -R backup:backup /home/backup/loki
+46 23 * * * backup duplicity --no-encryption full /home/backup/loki/ rsync://MJeyhun@backup.batice.ttu/loki
+48 23 * * * backup duplicity --no-encryption incremental /home/backup/loki/ rsync://MJeyhun@backup.batice.ttu/loki
+

changed: [MJeyhun-3]

TASK [loki : start cron] *******************************************************
ok: [MJeyhun-3]

TASK [loki : Add CNAME records for Loki] ***************************************
changed: [MJeyhun-3] => (item=None)
changed: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

RUNNING HANDLER [loki : Restart Loki] ******************************************
changed: [MJeyhun-3]

RUNNING HANDLER [loki : restart cron] ******************************************
changed: [MJeyhun-3]

RUNNING HANDLER [loki : reload rndc] *******************************************
changed: [MJeyhun-3]

PLAY [Promtail server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [promtail : Install Promtail] *********************************************
The following NEW packages will be installed:
  promtail
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-3]
The following NEW packages will be installed:
  promtail
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]
The following NEW packages will be installed:
  promtail
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]

TASK [promtail : Add promtail user to adm group] *******************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]
changed: [MJeyhun-3]

TASK [promtail : Check if agama log exists] ************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [promtail : Allow adm group to read agama log] ****************************
skipping: [MJeyhun-1]
skipping: [MJeyhun-2]
skipping: [MJeyhun-3]

TASK [promtail : Create Promtail positions directory] **************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 112,
     "path": "/var/lib/promtail",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 112,
     "path": "/var/lib/promtail",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 112,
     "path": "/var/lib/promtail",
-    "state": "absent"
+    "state": "directory"
 }

changed: [MJeyhun-3]

TASK [promtail : Configure Promtail] *******************************************
--- before: /etc/promtail/config.yml
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp7nn15pgw/config.yml.j2
@@ -1,24 +1,60 @@
-# This minimal config scrape only single log file.
-# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
-# And too much scraping during init process can overload the complete system.
-# https://github.com/grafana/loki/issues/11398
-
 server:
   http_listen_port: 9080
   grpc_listen_port: 0
 
 positions:
-  filename: /tmp/positions.yaml
+  filename: /var/lib/promtail/positions.yaml
 
 clients:
-- url: http://localhost:3100/loki/api/v1/push
+  - url: "http://loki:3100/loki/api/v1/push"
 
 scrape_configs:
-- job_name: system
-  static_configs:
-  - targets:
-      - localhost
-    labels:
-      job: varlogs
-      #NOTE: Need to be modified to scrape any additional logs of the system.
-      __path__: /var/log/messages
+  - job_name: system
+    static_configs:
+      - targets:
+          - localhost
+        labels:
+          host: MJeyhun-2
+          __path__: /var/log/syslog
+
+
+#  - job_name: agama
+#    static_configs:
+#      - targets: [localhost]
+#        labels:
+#          job: agama
+#          hostname: "MJeyhun-2"
+#          __path__: /var/log/uwsgi/app/agama.log
+
+  - job_name: nginx_access
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: nginx
+          hostname: "MJeyhun-2"
+          __path__: /var/log/nginx/access.log
+
+  - job_name: nginx_error
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: nginx
+          hostname: "MJeyhun-2"
+          __path__: /var/log/nginx/error.log
+
+  - job_name: agama_sli
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: agama
+          hostname: "MJeyhun-2"
+          __path__: /var/log/nginx/agama.log
+ 
+  - job_name: syslog
+    syslog:
+      listen_address: 0.0.0.0:8814
+      label_structured_data: true
+      labels:
+        job: haproxy
+        service: haproxy
+        host: MJeyhun-2 

changed: [MJeyhun-2]
--- before: /etc/promtail/config.yml
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp8s89_sd9/config.yml.j2
@@ -1,24 +1,60 @@
-# This minimal config scrape only single log file.
-# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
-# And too much scraping during init process can overload the complete system.
-# https://github.com/grafana/loki/issues/11398
-
 server:
   http_listen_port: 9080
   grpc_listen_port: 0
 
 positions:
-  filename: /tmp/positions.yaml
+  filename: /var/lib/promtail/positions.yaml
 
 clients:
-- url: http://localhost:3100/loki/api/v1/push
+  - url: "http://loki:3100/loki/api/v1/push"
 
 scrape_configs:
-- job_name: system
-  static_configs:
-  - targets:
-      - localhost
-    labels:
-      job: varlogs
-      #NOTE: Need to be modified to scrape any additional logs of the system.
-      __path__: /var/log/messages
+  - job_name: system
+    static_configs:
+      - targets:
+          - localhost
+        labels:
+          host: MJeyhun-1
+          __path__: /var/log/syslog
+
+
+#  - job_name: agama
+#    static_configs:
+#      - targets: [localhost]
+#        labels:
+#          job: agama
+#          hostname: "MJeyhun-1"
+#          __path__: /var/log/uwsgi/app/agama.log
+
+  - job_name: nginx_access
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: nginx
+          hostname: "MJeyhun-1"
+          __path__: /var/log/nginx/access.log
+
+  - job_name: nginx_error
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: nginx
+          hostname: "MJeyhun-1"
+          __path__: /var/log/nginx/error.log
+
+  - job_name: agama_sli
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: agama
+          hostname: "MJeyhun-1"
+          __path__: /var/log/nginx/agama.log
+ 
+  - job_name: syslog
+    syslog:
+      listen_address: 0.0.0.0:8814
+      label_structured_data: true
+      labels:
+        job: haproxy
+        service: haproxy
+        host: MJeyhun-1 

changed: [MJeyhun-1]
--- before: /etc/promtail/config.yml
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp6mpox6iw/config.yml.j2
@@ -1,24 +1,60 @@
-# This minimal config scrape only single log file.
-# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
-# And too much scraping during init process can overload the complete system.
-# https://github.com/grafana/loki/issues/11398
-
 server:
   http_listen_port: 9080
   grpc_listen_port: 0
 
 positions:
-  filename: /tmp/positions.yaml
+  filename: /var/lib/promtail/positions.yaml
 
 clients:
-- url: http://localhost:3100/loki/api/v1/push
+  - url: "http://loki:3100/loki/api/v1/push"
 
 scrape_configs:
-- job_name: system
-  static_configs:
-  - targets:
-      - localhost
-    labels:
-      job: varlogs
-      #NOTE: Need to be modified to scrape any additional logs of the system.
-      __path__: /var/log/messages
+  - job_name: system
+    static_configs:
+      - targets:
+          - localhost
+        labels:
+          host: MJeyhun-3
+          __path__: /var/log/syslog
+
+
+#  - job_name: agama
+#    static_configs:
+#      - targets: [localhost]
+#        labels:
+#          job: agama
+#          hostname: "MJeyhun-3"
+#          __path__: /var/log/uwsgi/app/agama.log
+
+  - job_name: nginx_access
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: nginx
+          hostname: "MJeyhun-3"
+          __path__: /var/log/nginx/access.log
+
+  - job_name: nginx_error
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: nginx
+          hostname: "MJeyhun-3"
+          __path__: /var/log/nginx/error.log
+
+  - job_name: agama_sli
+    static_configs:
+      - targets: [localhost]
+        labels:
+          job: agama
+          hostname: "MJeyhun-3"
+          __path__: /var/log/nginx/agama.log
+ 
+  - job_name: syslog
+    syslog:
+      listen_address: 0.0.0.0:8814
+      label_structured_data: true
+      labels:
+        job: haproxy
+        service: haproxy
+        host: MJeyhun-3 

changed: [MJeyhun-3]

TASK [promtail : Enable and start Promtail] ************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]
ok: [MJeyhun-3]

RUNNING HANDLER [promtail : restart promtail] **********************************
changed: [MJeyhun-3]
changed: [MJeyhun-1]
changed: [MJeyhun-2]

PLAY [Haproxy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Install HAProxy and HAProxy Exporter] **************************
The following additional packages will be installed:
  liblua5.4-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.4-0
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following additional packages will be installed:
  liblua5.4-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.4-0
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [haproxy : Config file for HAProxy] ***************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp09uymc7f/haproxy.cfg.j2
@@ -1,34 +1,59 @@
 global
-	log /dev/log	local0
-	log /dev/log	local1 notice
+        log ring@logbuffer local0 info
 	chroot /var/lib/haproxy
-	stats socket /run/haproxy/admin.sock mode 660 level admin
-	stats timeout 30s
-	user haproxy
-	group haproxy
-	daemon
+        stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
+        stats timeout 30s
+        user haproxy
+        group haproxy
+        daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
+        # Default SSL material locations
+        ca-base /etc/ssl/certs
+        crt-base /etc/ssl/private
 
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
+        # See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
         ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
         ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
         ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
-	log	global
-	mode	http
-	option	httplog
-	option	dontlognull
+        log     global
+        mode    http
+        option  httplog
+        option  dontlognull
         timeout connect 5000
         timeout client  50000
         timeout server  50000
-	errorfile 400 /etc/haproxy/errors/400.http
-	errorfile 403 /etc/haproxy/errors/403.http
-	errorfile 408 /etc/haproxy/errors/408.http
-	errorfile 500 /etc/haproxy/errors/500.http
-	errorfile 502 /etc/haproxy/errors/502.http
-	errorfile 503 /etc/haproxy/errors/503.http
-	errorfile 504 /etc/haproxy/errors/504.http
+        errorfile 400 /etc/haproxy/errors/400.http
+        errorfile 403 /etc/haproxy/errors/403.http
+        errorfile 408 /etc/haproxy/errors/408.http
+        errorfile 500 /etc/haproxy/errors/500.http
+        errorfile 502 /etc/haproxy/errors/502.http
+        errorfile 503 /etc/haproxy/errors/503.http
+        errorfile 504 /etc/haproxy/errors/504.http
+
+ring logbuffer
+    description "HAProxy -> Promtail syslog over TCP"
+    format rfc5424
+    maxlen 1500
+    size 65536
+    timeout connect 10s
+    timeout server 20s
+    server promtail localhost:8814
+
+frontend my_ha_frontend
+    bind :88
+    log-format "%ST %Tr"
+    default_backend my_ha_backend
+
+backend my_ha_backend
+    server docker1 www-1:8001 check
+    server docker2 www-1:8002 check
+    server docker3 www-2:8001 check
+    server docker4 www-2:8002 check
+
+listen stats
+    bind :8404
+    stats enable
+    stats uri /stats
+

changed: [MJeyhun-2]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmp7xt6lmk6/haproxy.cfg.j2
@@ -1,34 +1,59 @@
 global
-	log /dev/log	local0
-	log /dev/log	local1 notice
+        log ring@logbuffer local0 info
 	chroot /var/lib/haproxy
-	stats socket /run/haproxy/admin.sock mode 660 level admin
-	stats timeout 30s
-	user haproxy
-	group haproxy
-	daemon
+        stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
+        stats timeout 30s
+        user haproxy
+        group haproxy
+        daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
+        # Default SSL material locations
+        ca-base /etc/ssl/certs
+        crt-base /etc/ssl/private
 
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
+        # See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
         ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
         ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
         ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
-	log	global
-	mode	http
-	option	httplog
-	option	dontlognull
+        log     global
+        mode    http
+        option  httplog
+        option  dontlognull
         timeout connect 5000
         timeout client  50000
         timeout server  50000
-	errorfile 400 /etc/haproxy/errors/400.http
-	errorfile 403 /etc/haproxy/errors/403.http
-	errorfile 408 /etc/haproxy/errors/408.http
-	errorfile 500 /etc/haproxy/errors/500.http
-	errorfile 502 /etc/haproxy/errors/502.http
-	errorfile 503 /etc/haproxy/errors/503.http
-	errorfile 504 /etc/haproxy/errors/504.http
+        errorfile 400 /etc/haproxy/errors/400.http
+        errorfile 403 /etc/haproxy/errors/403.http
+        errorfile 408 /etc/haproxy/errors/408.http
+        errorfile 500 /etc/haproxy/errors/500.http
+        errorfile 502 /etc/haproxy/errors/502.http
+        errorfile 503 /etc/haproxy/errors/503.http
+        errorfile 504 /etc/haproxy/errors/504.http
+
+ring logbuffer
+    description "HAProxy -> Promtail syslog over TCP"
+    format rfc5424
+    maxlen 1500
+    size 65536
+    timeout connect 10s
+    timeout server 20s
+    server promtail localhost:8814
+
+frontend my_ha_frontend
+    bind :88
+    log-format "%ST %Tr"
+    default_backend my_ha_backend
+
+backend my_ha_backend
+    server docker1 www-1:8001 check
+    server docker2 www-1:8002 check
+    server docker3 www-2:8001 check
+    server docker4 www-2:8002 check
+
+listen stats
+    bind :8404
+    stats enable
+    stats uri /stats
+

changed: [MJeyhun-1]

TASK [haproxy : Haproxy started] ***********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Install prometheus haproxy exporter] ***************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]

TASK [haproxy : Config file for exporter] **************************************
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpmdaq_0aw/prometheus-haproxy-exporter.j2
@@ -1,5 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell escaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--haproxy.scrape-uri='http://MJeyhun-2.batice.ttu:8404/stats;csv' --web.listen-address=':9188'"

changed: [MJeyhun-2]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpw4epwmh1/prometheus-haproxy-exporter.j2
@@ -1,5 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell escaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+ARGS="--haproxy.scrape-uri='http://MJeyhun-1.batice.ttu:8404/stats;csv' --web.listen-address=':9188'"

changed: [MJeyhun-1]

TASK [haproxy : Ensure haproxy-exporter is enabled and running] ****************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Add CNAME records for haproxy] *********************************
changed: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
changed: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
changed: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

RUNNING HANDLER [haproxy : restart haproxy] ************************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

RUNNING HANDLER [haproxy : prometheus-haproxy-exporter restart] ****************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

RUNNING HANDLER [haproxy : reload rndc] ****************************************
changed: [MJeyhun-1]

PLAY [Keepalived] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Install keepalived] *****************************************
The following additional packages will be installed:
  ipvsadm
Suggested packages:
  heartbeat ldirectord
The following NEW packages will be installed:
  ipvsadm keepalived
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-2]
The following additional packages will be installed:
  ipvsadm
Suggested packages:
  heartbeat ldirectord
The following NEW packages will be installed:
  ipvsadm keepalived
0 upgraded, 2 newly installed, 0 to remove and 256 not upgraded.
changed: [MJeyhun-1]

TASK [keepalived : Download Keepalived exporter package] ***********************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [keepalived : Install Keepalived exporter] ********************************
Selecting previously unselected package keepalived-exporter.
(Reading database ... 77331 files and directories currently installed.)
Preparing to unpack .../keepalived-exporter_1.7.0_linux_amd64.deb ...
Unpacking keepalived-exporter (1.7.0) ...
Setting up keepalived-exporter (1.7.0) ...
changed: [MJeyhun-2]
Selecting previously unselected package keepalived-exporter.
(Reading database ... 77331 files and directories currently installed.)
Preparing to unpack .../keepalived-exporter_1.7.0_linux_amd64.deb ...
Unpacking keepalived-exporter (1.7.0) ...
Setting up keepalived-exporter (1.7.0) ...
changed: [MJeyhun-1]

TASK [keepalived : Deploy Keepalived Exporter service file] ********************
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpgogqchp_/keepalived-exporter.service.j2
@@ -0,0 +1,10 @@
+Description=Prometheus Keepalived Exporter
+After=network.target
+
+[Service]
+User=root
+ExecStart=/usr/bin/keepalived-exporter --web.listen-address ":9165" --web.telemetry-path "/metrics"
+Restart=always
+
+[Install]
+WantedBy=multi-user.target

changed: [MJeyhun-1]
--- before
+++ after: /home/raven/.ansible/tmp/ansible-local-11939nsb5bt2u/tmpi9gz7z37/keepalived-exporter.service.j2
@@ -0,0 +1,10 @@
+Description=Prometheus Keepalived Exporter
+After=network.target
+
+[Service]
+User=root
+ExecStart=/usr/bin/keepalived-exporter --web.listen-address ":9165" --web.telemetry-path "/metrics"
+Restart=always
+
+[Install]
+WantedBy=multi-user.target

changed: [MJeyhun-2]

TASK [keepalived : Reload Daemon] **********************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Create keepalived script user] ******************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [keepalived : Ensure keepalived_script home directory exists] *************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "mode": "0750",
+    "mode": "0755",
     "path": "/home/keepalived_script"
 }

changed: [MJeyhun-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "mode": "0750",
+    "mode": "0755",
     "path": "/home/keepalived_script"
 }

changed: [MJeyhun-2]

TASK [keepalived : Upload check script] ****************************************
--- before
+++ after: /home/raven/ica0002/roles/keepalived/files/check_haproxy.sh
@@ -0,0 +1,9 @@
+#!/bin/bash
+#!/bin/bash
+if ss -ntl | grep -q ':88 '; then
+    echo "HAProxy is UP"
+    exit 0
+else
+    echo "HAProxy is DOWN"
+    exit 1
+fi

changed: [MJeyhun-2]
--- before
+++ after: /home/raven/ica0002/roles/keepalived/files/check_haproxy.sh
@@ -0,0 +1,9 @@
+#!/bin/bash
+#!/bin/bash
+if ss -ntl | grep -q ':88 '; then
+    echo "HAProxy is UP"
+    exit 0
+else
+    echo "HAProxy is DOWN"
+    exit 1
+fi

changed: [MJeyhun-1]

TASK [keepalived : Deploy keepalived.conf] *************************************
changed: [MJeyhun-2]
changed: [MJeyhun-1]

TASK [keepalived : Enable and start Keepalived service] ************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

TASK [keepalived : Ensure prometheus-keepalived-exporter service is enabled and started] ***
changed: [MJeyhun-2]
changed: [MJeyhun-1]

RUNNING HANDLER [keepalived : Restart Keepalived] ******************************
changed: [MJeyhun-1]
changed: [MJeyhun-2]

RUNNING HANDLER [keepalived : Restart prometheus-keepalived-exporter] **********
changed: [MJeyhun-2]
changed: [MJeyhun-1]

PLAY RECAP *********************************************************************
MJeyhun-1                  : ok=96   changed=74   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
MJeyhun-2                  : ok=90   changed=68   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
MJeyhun-3                  : ok=78   changed=58   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   


PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host MJeyhun-1 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host MJeyhun-2 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host MJeyhun-3 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [init : Update APT cache] *************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [init : Install Prometheus Node Exporter] *********************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [init : Ensure Prometheus Node Exporter is started and enabled] ***********
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [init : Add Grafana GPG key] **********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [init : Add grafana repo] *************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [init : Ensure the "backup" user exists and SSH key pair is generated] ****
[WARNING]: Found existing ssh key private file "/home/backup/.ssh/id_rsa", no
force, so skipping ssh-keygen generation
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [init : Add backup server SSH key to known_hosts for user backup] *********
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [init : Ensure restore directory exists] **********************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [init : Install duplicity] ************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY [DNS Servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [bind : Install bind9] ****************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [bind : Install dnspython] ************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [bind : template] *********************************************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-2]
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3]
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-1]

TASK [bind : template] *********************************************************
skipping: [MJeyhun-2]
skipping: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [bind : template] *********************************************************
skipping: [MJeyhun-2]
skipping: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [bind : Flush] ************************************************************

TASK [bind : Flush] ************************************************************

TASK [bind : Flush] ************************************************************

TASK [bind : Enable bind9] *****************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [bind : Install Bind9 exporter] *******************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [bind : Ensure Bind exporter is running and enabled] **********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [bind : Add A records] ****************************************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3]

TASK [bind : Add CNAME records for nameserver] *********************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3]

PLAY [Resolve] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [resolver : Check if /etc/resolver.conf exists] ***************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [resolver : Unlink /etc/resolv.conf if it exists and is a symlink] ********
skipping: [MJeyhun-1]
skipping: [MJeyhun-2]
skipping: [MJeyhun-3]

TASK [resolver : Apply /etc/resolv.conf template] ******************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

PLAY [Web Servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [docker : Install Docker and prerequisites] *******************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [docker : Ensure Docker service is running] *******************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [docker : Install Loki Docker plugin] *************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [agama : Create /opt/agama directory] *************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [agama : Download Agama app and Dockerfile] *******************************
ok: [MJeyhun-2] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/agama.py', 'dest': 'agama.py'})
ok: [MJeyhun-1] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/agama.py', 'dest': 'agama.py'})
ok: [MJeyhun-1] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/Dockerfile', 'dest': 'Dockerfile'})
ok: [MJeyhun-2] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/Dockerfile', 'dest': 'Dockerfile'})

TASK [agama : Build Agama Docker image] ****************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [agama : Start Agama Docker container] ************************************
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-2]
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-1]

TASK [agama : Add CNAME records for Web Servers] *******************************
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

TASK [nginx : install nginx] ***************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [nginx : Apply Nginx configuration using template] ************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Nginx service] ***************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [nginx : Install Nginx exporter] ******************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [nginx : Ensure nginx exporter started] ***********************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Install MySQL server] ********************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Ensure MySQL service is started and enabled] *********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : MySQL override.cnf] **********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Install Python MySQL library] ************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : MySQL database] **************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : MySQL User] ******************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Install MySQL exporter] ******************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Cnf files for exporter] ******************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Create MySQL user for the exporter] ******************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Configure mysqld_exporter systemd service to use .my.cnf] ********
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Ensure Prometheus MySQL Exporter is started and enabled] *********
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Ensure MySQL backup directory exists] ****************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Create backup MySQL user and grant privileges] *******************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Create .my.cnf for backup user] **********************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Ensure /etc/cron.d/mysql-backup is created] **********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : start cron] ******************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Create replication user with REPLICATION SLAVE permissions] ******
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Set MySQL read_only mode dynamically] ****************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Add CNAME records for mysql] *************************************
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

PLAY [Prometheus Server] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [prometheus : install prometheus] *****************************************
ok: [MJeyhun-3]

TASK [prometheus : Ensure Prometheus service is enabled and started] ***********
ok: [MJeyhun-3]

TASK [prometheus : Apply Prometheus default configuration from template] *******
ok: [MJeyhun-3]

TASK [prometheus : Update Prometheus config] ***********************************
ok: [MJeyhun-3]

TASK [prometheus : Install Prometheus backup cron] *****************************
ok: [MJeyhun-3]

TASK [prometheus : start cron] *************************************************
ok: [MJeyhun-3]

TASK [prometheus : Add CNAME records for prometheus] ***************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

TASK [nginx : install nginx] ***************************************************
ok: [MJeyhun-3]

TASK [nginx : Apply Nginx configuration using template] ************************
ok: [MJeyhun-3]

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Nginx service] ***************************************************
ok: [MJeyhun-3]

TASK [nginx : Install Nginx exporter] ******************************************
ok: [MJeyhun-3]

TASK [nginx : Ensure nginx exporter started] ***********************************
ok: [MJeyhun-3]

PLAY [Grafana server] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [docker : Install Docker and prerequisites] *******************************
ok: [MJeyhun-3]

TASK [docker : Ensure Docker service is running] *******************************
ok: [MJeyhun-3]

TASK [docker : Install Loki Docker plugin] *************************************
ok: [MJeyhun-3]

TASK [grafana : Create Grafana directories] ************************************
ok: [MJeyhun-3] => (item=/opt/grafana)
ok: [MJeyhun-3] => (item=/opt/grafana/provisioning)
ok: [MJeyhun-3] => (item=/opt/grafana/provisioning/dashboards)
ok: [MJeyhun-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Create Grafana configuration file from template securely] ******
ok: [MJeyhun-3]

TASK [grafana : Grafana Docker container] **************************************
ok: [MJeyhun-3]

TASK [grafana : Create Grafana dashboard file] *********************************
ok: [MJeyhun-3]

TASK [grafana : Create Grafana datasource provisioning file] *******************
ok: [MJeyhun-3]

TASK [grafana : Upload main.json to the server] ********************************
ok: [MJeyhun-3] => (item=main.json)
ok: [MJeyhun-3] => (item=backups.json)
ok: [MJeyhun-3] => (item=agama_logs.json)
ok: [MJeyhun-3] => (item=mysql.json)

TASK [grafana : Add CNAME records for Grafana] *********************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

PLAY [Loki server] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [loki : Install Loki] *****************************************************
ok: [MJeyhun-3]

TASK [loki : Create Loki data directory] ***************************************
ok: [MJeyhun-3]

TASK [loki : Configure Loki] ***************************************************
ok: [MJeyhun-3]

TASK [loki : Enable and start Loki] ********************************************
ok: [MJeyhun-3]

TASK [loki : Ensure Loki backup directory exists] ******************************
ok: [MJeyhun-3]

TASK [loki : Install Loki backup cron] *****************************************
ok: [MJeyhun-3]

TASK [loki : start cron] *******************************************************
ok: [MJeyhun-3]

TASK [loki : Add CNAME records for Loki] ***************************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

PLAY [Promtail server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [promtail : Install Promtail] *********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [promtail : Add promtail user to adm group] *******************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [promtail : Check if agama log exists] ************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [promtail : Allow adm group to read agama log] ****************************
skipping: [MJeyhun-1]
skipping: [MJeyhun-2]
skipping: [MJeyhun-3]

TASK [promtail : Create Promtail positions directory] **************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [promtail : Configure Promtail] *******************************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [promtail : Enable and start Promtail] ************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

PLAY [Haproxy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [haproxy : Install HAProxy and HAProxy Exporter] **************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [haproxy : Config file for HAProxy] ***************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Haproxy started] ***********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Install prometheus haproxy exporter] ***************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Config file for exporter] **************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Ensure haproxy-exporter is enabled and running] ****************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [haproxy : Add CNAME records for haproxy] *********************************
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

PLAY [Keepalived] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Install keepalived] *****************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Download Keepalived exporter package] ***********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Install Keepalived exporter] ********************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Deploy Keepalived Exporter service file] ********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Reload Daemon] **********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Create keepalived script user] ******************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Ensure keepalived_script home directory exists] *************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Upload check script] ****************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Deploy keepalived.conf] *************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Enable and start Keepalived service] ************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Ensure prometheus-keepalived-exporter service is enabled and started] ***
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY RECAP *********************************************************************
MJeyhun-1                  : ok=81   changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
MJeyhun-2                  : ok=78   changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
MJeyhun-3                  : ok=64   changed=0    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   

MJeyhun-1 | CHANGED => {
    "changed": true,
    "elapsed": 84,
    "rebooted": true
}
MJeyhun-3 | CHANGED => {
    "changed": true,
    "elapsed": 83,
    "rebooted": true
}
MJeyhun-2 | CHANGED => {
    "changed": true,
    "elapsed": 83,
    "rebooted": true
}

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host MJeyhun-3 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host MJeyhun-2 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host MJeyhun-1 is using the discovered Python
interpreter at /usr/bin/python3.12, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.18/reference_appendices/interpreter_discovery.html for more information.
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [init : Update APT cache] *************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [init : Install Prometheus Node Exporter] *********************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [init : Ensure Prometheus Node Exporter is started and enabled] ***********
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [init : Add Grafana GPG key] **********************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [init : Add grafana repo] *************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [init : Ensure the "backup" user exists and SSH key pair is generated] ****
[WARNING]: Found existing ssh key private file "/home/backup/.ssh/id_rsa", no
force, so skipping ssh-keygen generation
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [init : Add backup server SSH key to known_hosts for user backup] *********
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [init : Ensure restore directory exists] **********************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [init : Install duplicity] ************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY [DNS Servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [bind : Install bind9] ****************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [bind : Install dnspython] ************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [bind : template] *********************************************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3]
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-2]
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-1]

TASK [bind : template] *********************************************************
skipping: [MJeyhun-2]
skipping: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [bind : template] *********************************************************
skipping: [MJeyhun-2]
skipping: [MJeyhun-1]
ok: [MJeyhun-3]

TASK [bind : Flush] ************************************************************

TASK [bind : Flush] ************************************************************

TASK [bind : Flush] ************************************************************

TASK [bind : Enable bind9] *****************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [bind : Install Bind9 exporter] *******************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [bind : Ensure Bind exporter is running and enabled] **********************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [bind : Add A records] ****************************************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3]

TASK [bind : Add CNAME records for nameserver] *********************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3]

PLAY [Resolve] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [resolver : Check if /etc/resolver.conf exists] ***************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [resolver : Unlink /etc/resolv.conf if it exists and is a symlink] ********
skipping: [MJeyhun-1]
skipping: [MJeyhun-2]
skipping: [MJeyhun-3]

TASK [resolver : Apply /etc/resolv.conf template] ******************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

PLAY [Web Servers] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [docker : Install Docker and prerequisites] *******************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [docker : Ensure Docker service is running] *******************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [docker : Install Loki Docker plugin] *************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [agama : Create /opt/agama directory] *************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [agama : Download Agama app and Dockerfile] *******************************
ok: [MJeyhun-1] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/agama.py', 'dest': 'agama.py'})
ok: [MJeyhun-2] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/agama.py', 'dest': 'agama.py'})
ok: [MJeyhun-1] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/Dockerfile', 'dest': 'Dockerfile'})
ok: [MJeyhun-2] => (item={'url': 'https://raw.githubusercontent.com/hudolejev/agama/main/Dockerfile', 'dest': 'Dockerfile'})

TASK [agama : Build Agama Docker image] ****************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [agama : Start Agama Docker container] ************************************
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-1] => (item=None)
ok: [MJeyhun-1]
ok: [MJeyhun-2] => (item=None)
ok: [MJeyhun-2]

TASK [agama : Add CNAME records for Web Servers] *******************************
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

TASK [nginx : install nginx] ***************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [nginx : Apply Nginx configuration using template] ************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Nginx service] ***************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [nginx : Install Nginx exporter] ******************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [nginx : Ensure nginx exporter started] ***********************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Install MySQL server] ********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Ensure MySQL service is started and enabled] *********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : MySQL override.cnf] **********************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Install Python MySQL library] ************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : MySQL database] **************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : MySQL User] ******************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Install MySQL exporter] ******************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Cnf files for exporter] ******************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Create MySQL user for the exporter] ******************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Configure mysqld_exporter systemd service to use .my.cnf] ********
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Ensure Prometheus MySQL Exporter is started and enabled] *********
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Ensure MySQL backup directory exists] ****************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Create backup MySQL user and grant privileges] *******************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [mysql : Create .my.cnf for backup user] **********************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Ensure /etc/cron.d/mysql-backup is created] **********************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : start cron] ******************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Create replication user with REPLICATION SLAVE permissions] ******
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Set MySQL read_only mode dynamically] ****************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [mysql : Add CNAME records for mysql] *************************************
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

PLAY [Prometheus Server] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [prometheus : install prometheus] *****************************************
ok: [MJeyhun-3]

TASK [prometheus : Ensure Prometheus service is enabled and started] ***********
ok: [MJeyhun-3]

TASK [prometheus : Apply Prometheus default configuration from template] *******
ok: [MJeyhun-3]

TASK [prometheus : Update Prometheus config] ***********************************
ok: [MJeyhun-3]

TASK [prometheus : Install Prometheus backup cron] *****************************
ok: [MJeyhun-3]

TASK [prometheus : start cron] *************************************************
ok: [MJeyhun-3]

TASK [prometheus : Add CNAME records for prometheus] ***************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

TASK [nginx : install nginx] ***************************************************
ok: [MJeyhun-3]

TASK [nginx : Apply Nginx configuration using template] ************************
ok: [MJeyhun-3]

TASK [nginx : Flush handlers] **************************************************

TASK [nginx : Nginx service] ***************************************************
ok: [MJeyhun-3]

TASK [nginx : Install Nginx exporter] ******************************************
ok: [MJeyhun-3]

TASK [nginx : Ensure nginx exporter started] ***********************************
ok: [MJeyhun-3]

PLAY [Grafana server] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [docker : Install Docker and prerequisites] *******************************
ok: [MJeyhun-3]

TASK [docker : Ensure Docker service is running] *******************************
ok: [MJeyhun-3]

TASK [docker : Install Loki Docker plugin] *************************************
ok: [MJeyhun-3]

TASK [grafana : Create Grafana directories] ************************************
ok: [MJeyhun-3] => (item=/opt/grafana)
ok: [MJeyhun-3] => (item=/opt/grafana/provisioning)
ok: [MJeyhun-3] => (item=/opt/grafana/provisioning/dashboards)
ok: [MJeyhun-3] => (item=/opt/grafana/provisioning/datasources)

TASK [grafana : Create Grafana configuration file from template securely] ******
ok: [MJeyhun-3]

TASK [grafana : Grafana Docker container] **************************************
ok: [MJeyhun-3]

TASK [grafana : Create Grafana dashboard file] *********************************
ok: [MJeyhun-3]

TASK [grafana : Create Grafana datasource provisioning file] *******************
ok: [MJeyhun-3]

TASK [grafana : Upload main.json to the server] ********************************
ok: [MJeyhun-3] => (item=main.json)
ok: [MJeyhun-3] => (item=backups.json)
ok: [MJeyhun-3] => (item=agama_logs.json)
ok: [MJeyhun-3] => (item=mysql.json)

TASK [grafana : Add CNAME records for Grafana] *********************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

PLAY [Loki server] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]

TASK [loki : Install Loki] *****************************************************
ok: [MJeyhun-3]

TASK [loki : Create Loki data directory] ***************************************
ok: [MJeyhun-3]

TASK [loki : Configure Loki] ***************************************************
ok: [MJeyhun-3]

TASK [loki : Enable and start Loki] ********************************************
ok: [MJeyhun-3]

TASK [loki : Ensure Loki backup directory exists] ******************************
ok: [MJeyhun-3]

TASK [loki : Install Loki backup cron] *****************************************
ok: [MJeyhun-3]

TASK [loki : start cron] *******************************************************
ok: [MJeyhun-3]

TASK [loki : Add CNAME records for Loki] ***************************************
ok: [MJeyhun-3] => (item=None)
ok: [MJeyhun-3 -> {{ groups['dns_primary'][0] }}]

PLAY [Promtail server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-3]
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [promtail : Install Promtail] *********************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [promtail : Add promtail user to adm group] *******************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

TASK [promtail : Check if agama log exists] ************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [promtail : Allow adm group to read agama log] ****************************
skipping: [MJeyhun-1]
skipping: [MJeyhun-2]
skipping: [MJeyhun-3]

TASK [promtail : Create Promtail positions directory] **************************
ok: [MJeyhun-2]
ok: [MJeyhun-3]
ok: [MJeyhun-1]

TASK [promtail : Configure Promtail] *******************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]
ok: [MJeyhun-3]

TASK [promtail : Enable and start Promtail] ************************************
ok: [MJeyhun-1]
ok: [MJeyhun-3]
ok: [MJeyhun-2]

PLAY [Haproxy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Install HAProxy and HAProxy Exporter] **************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Config file for HAProxy] ***************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [haproxy : Haproxy started] ***********************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [haproxy : Install prometheus haproxy exporter] ***************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Config file for exporter] **************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Ensure haproxy-exporter is enabled and running] ****************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [haproxy : Add CNAME records for haproxy] *********************************
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> MJeyhun-3(193.40.157.25)] => (item=None)
ok: [MJeyhun-1 -> {{ groups['dns_primary'][0] }}]

PLAY [Keepalived] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Install keepalived] *****************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Download Keepalived exporter package] ***********************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Install Keepalived exporter] ********************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Deploy Keepalived Exporter service file] ********************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Reload Daemon] **********************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Create keepalived script user] ******************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Ensure keepalived_script home directory exists] *************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Upload check script] ****************************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Deploy keepalived.conf] *************************************
ok: [MJeyhun-1]
ok: [MJeyhun-2]

TASK [keepalived : Enable and start Keepalived service] ************************
ok: [MJeyhun-2]
ok: [MJeyhun-1]

TASK [keepalived : Ensure prometheus-keepalived-exporter service is enabled and started] ***
ok: [MJeyhun-2]
ok: [MJeyhun-1]

PLAY RECAP *********************************************************************
MJeyhun-1                  : ok=81   changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
MJeyhun-2                  : ok=78   changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
MJeyhun-3                  : ok=64   changed=0    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   

Thu Jan 15 08:48:33 EET 2026
