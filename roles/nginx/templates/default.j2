log_format agama_format '$status $request_time';

server {
    listen 80 default_server;
    server_name _;
        {% if inventory_hostname in groups['web_servers'] %}
        location / {
                uwsgi_pass localhost:5000;
                include uwsgi_params;
		access_log /var/log/nginx/access.log;
		access_log /var/log/nginx/agama.log status_time;
        }
        {% endif %}

        {% if inventory_hostname in groups['prometheus_servers'] %}
        location /prometheus {
            proxy_pass http://localhost:9090;
        }
        {% endif %}
	
	{% if inventory_hostname in groups['grafana_servers'] %}
        location /grafana {
		proxy_set_header Host $http_host;
                proxy_pass http://localhost:3000;
        }
	{% endif %}

}

server {
	listen 8080 default_server;
	location /stub_status {
		stub_status;
	}
}
