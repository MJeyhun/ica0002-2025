zone "{{ mydomain }}" {
{% if inventory_hostname in groups['dns_primary'] %}
  type primary;
  allow-update { key nsupdate.key; };
  allow-transfer {localhost;key transfer.key;};
  notify yes;
    	
{% else %}
  type secondary;
  allow-transfer {localhost;};
  primaries {
{% for vm in groups['dns_primary'] %}
      {{ hostvars[vm]['ansible_default_ipv4']['address'] }};
{% endfor %}
  };
{% endif %}

  file "db.{{ mydomain }}";
};


zone "168.192.in-addr.arpa" {
{% if inventory_hostname in groups['dns_primary'] %}
  type primary;
  allow-update { key nsupdate.key; };
  allow-transfer {localhost;key transfer.key;};
  notify yes;

{% else %}
  type secondary;
  allow-transfer {localhost;};
  primaries {
{% for vm in groups['dns_primary'] %}
      {{ hostvars[vm]['ansible_default_ipv4']['address'] }};
{% endfor %}
  };
{% endif %}

  file "db.rev";
};


{% if inventory_hostname in groups['dns_secondary'] %}
{% for vm in groups['dns_primary'] %}
server {{ hostvars[vm]['ansible_default_ipv4']['address'] }}{
    keys { {{ transfer_key_name }} ;}; 
};
{% endfor %}
{% endif %}
